# api-gateway-demo

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã API Gateway (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Spring Cloud Gateway) –∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ 
–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
api-gateway-demo/
‚îú‚îÄ‚îÄ api-gateway/          # API Gateway –Ω–∞ Spring Cloud Gateway
‚îú‚îÄ‚îÄ user-service/         # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îî‚îÄ‚îÄ order-service/        # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
```

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

- **`user-service`**: –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8081`. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—É—Ç–∏ `/users/{id}`.
- **`order-service`**: –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8082`. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—É—Ç–∏ `/orders/{id}`.

### API Gateway

- **`api-gateway`**: –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8080`.
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤.
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä `StripPrefix=1` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É—Ç–µ–π.

#### –ú–∞—Ä—à—Ä—É—Ç—ã

| –ü—É—Ç—å –≤ Gateway         | –¶–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–∏—Å | –ü—É—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ    | –§–∏–ª—å—Ç—Ä         |
| ---------------------- | -------------- | ----------------- | -------------- |
| `/api/users/**`        | `user-service` | `/users/{id}`     | `StripPrefix=1`|
| `/api/orders/**`       | `order-service`| `/orders/{id}`    | `StripPrefix=1`|

**–ü–æ—á–µ–º—É `StripPrefix=1`?**
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `http://localhost:8080/api/users/123`:
1. Gateway —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—É—Ç—å —Å —à–∞–±–ª–æ–Ω–æ–º `/api/users/**`.
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä `StripPrefix=1`, –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç **–ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å** –ø—É—Ç–∏ (`/api`).
3. –û—Å—Ç–∞–µ—Ç—Å—è –ø—É—Ç—å `/users/123`.
4. –≠—Ç–æ—Ç –ø—É—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `user-service` –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8081/users/123`.
5. `user-service` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç.
6. Gateway –ø–µ—Ä–µ–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É.

–ï—Å–ª–∏ –±—ã –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `StripPrefix=2`, —Ç–æ —É–¥–∞–ª—è–ª–∏—Å—å –±—ã –¥–≤–µ —á–∞—Å—Ç–∏ (`/api` –∏ `/users`), –∏ –∑–∞–ø—Ä–æ—Å —à—ë–ª –±—ã –≤ `user-service` –∫–∞–∫ `http://localhost:8081/123`, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –±—ã –∫ –æ—à–∏–±–∫–µ `404 Not Found`, —Ç–∞–∫ –∫–∞–∫ `user-service` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Ç—å `/123`.

## üöÄ –ó–∞–ø—É—Å–∫

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `user-service`:
```bash
./gradlew :user-service:bootRun
```
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `order-service`:
```bash
./gradlew :order-service:bootRun
```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `api-gateway`:
```bash
./gradlew :api-gateway:bootRun
```

## üß™ –ü—Ä–∏–º–µ—Ä—ã –≤—ã–∑–æ–≤–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —á–µ—Ä–µ–∑ Gateway
```bash
curl -v http://localhost:8080/api/users/123
```

### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ —á–µ—Ä–µ–∑ Gateway
```bash
curl -v http://localhost:8080/api/orders/456
```

### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
```bash
curl -v http://localhost:8081/users/123
```

### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
```bash
curl -v http://localhost:8082/orders/456
```
